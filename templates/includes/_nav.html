{% load i18n %}
{% get_current_language as CUR_LANG %}

<header>
    <div class="container">
        <nav>
            <a href="{% url 'home' %}">{% trans "Главная" %}</a>

            {% if DOCS_MENU and DOCS_MENU|length > 0 %}
                <details class="nav-dropdown" role="list" style="display:inline-block;margin-left:.75rem;">
                    <summary style="cursor:pointer;display:inline-block;list-style:none;">
                        {% trans "Документы" %}
                    </summary>
                    <ul role="list" style="margin:.25rem 0 0;padding:0 .5rem;">
                        {% for d in DOCS_MENU %}
                            <li style="margin:.25rem 0;">
                                <a href="{{ d.href }}">{{ d.title }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </details>
            {% endif %}

            {% if user.is_authenticated %}
                <a href="{% url 'dashboard' %}">{% trans "Личный кабинет" %}</a>
                <a href="{% url 'account_settings' %}">{% trans "Настройки" %}</a>
                <a href="{% url 'account_change_password' %}">{% trans "Сменить пароль" %}</a>
                <a href="{% url 'account_email' %}">{% trans "Email-адреса" %}</a>
                {% if user.is_staff %}
                    <a href="{% url 'twofa_setup' %}">{% trans "Безопасность (2FA)" %}</a>
                {% endif %}
                <a href="{% url 'account_delete' %}">{% trans "Удалить аккаунт" %}</a>
                <a href="{% url 'account_logout' %}">{% trans "Выйти" %}</a>
            {% else %}
                <a href="{% url 'account_login' %}">{% trans "Войти" %}</a>
                <a href="{% url 'account_signup' %}">{% trans "Регистрация" %}</a>
                <a href="{% url 'account_reset_password' %}">{% trans "Забыли пароль?" %}</a>
            {% endif %}
        </nav>

        <div class="muted" style="margin-top:8px">
            {% if user.is_authenticated %}
                {% trans "Вы вошли как" %} <strong>{{ user.email }}</strong>
                {% if user.is_staff %}
                    · {% trans "Админка" %}: <a href="{% url 'admin:index' %}">/{{ site_setup.admin_path }}/</a>
                {% endif %}
            {% else %}
                {% trans "Вы вошли как" %} <strong>{% trans "Анонимный пользователь" %}</strong>
            {% endif %}
        </div>

        <div class="muted" style="margin-top:4px">
            {% trans "Статус сервиса" %}:
            {% if MAINTENANCE_MODE %}
                <strong>{% trans "технические работы" %}</strong>
            {% else %}
                {% if IS_OPEN_NOW %}
                    <strong>{% trans "работает" %}</strong>
                {% else %}
                    <strong>{% trans "закрыто" %}</strong>
                {% endif %}
            {% endif %}
        </div>

        {# Переключатель языка (как у тебя было) #}
        <form action="{% url 'set_language' %}" method="post" class="lang-switch-form" style="display:inline">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}">

            <label for="lang-select" class="visually-hidden">{% trans "Выберите язык" %}</label>

            {% if LANG_MENU and LANG_MENU|length > 0 %}
                <select id="lang-select" name="language" data-lang-switch>
                    {% for item in LANG_MENU %}
                        <option value="{{ item.code }}"{% if item.active %} selected{% endif %}>
                            {{ item.name }}
                        </option>
                    {% endfor %}
                </select>
            {% else %}
                {% get_available_languages as ALL_LANGS %}
                {% get_language_info_list for ALL_LANGS as ALL_LANG_INFOS %}
                <select id="lang-select" name="language" data-lang-switch>
                    {% for lang in ALL_LANG_INFOS %}
                        <option value="{{ lang.code }}"{% if lang.code == CUR_LANG %} selected{% endif %}>
                            {{ lang.name_local }}
                        </option>
                    {% endfor %}
                </select>
            {% endif %}

            <noscript>
                <button type="submit">{% trans "OK" %}</button>
            </noscript>
        </form>
    </div>
</header>
