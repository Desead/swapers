# JSON‑LD: краткое руководство для Swapers

> Цель: дать понятные правила, как заполнять и поддерживать структурированные данные (schema.org) на сайте обменника. Документ ориентирован на редакторов контента и разработчиков.

---

## 1) Что такое JSON‑LD и зачем он нам

* **JSON‑LD** — это блоки структурированных данных внутри HTML (`<script type="application/ld+json">…</script>`), которые помогают поисковикам понимать страницы.
* Даёт возможность получать **rich‑результаты** (карточки бренда, FAQ‑сниппеты, хлебные крошки, улучшенные сниппеты статей и т.д.).
* В нашем проекте по умолчанию есть два site‑wide блока: **Organization** и **WebSite** (задаются в `Настройки сайта → Структурированные данные (JSON‑LD)`).

---

## 2) Общие правила заполнения

1. **Только факты.** Не добавляем вымышленные рейтинги, отзывы или награды.
2. **Абсолютные URL.** Все ссылки и картинки — в виде `https://…` на наш домен (или официальный внешний ресурс).
3. **Согласованность с видимым контентом.** Всё, что в JSON‑LD, должно присутствовать на странице (хотя бы текстом или данными).
4. **Один блок — один тип.** Лучше несколько аккуратных блоков, чем один перегруженный.
5. **Мультиязычность.** Для каждой языковой версии страницы отдаём JSON‑LD со своим `url` и `inLanguage`.
6. **CSP.** Наши скрипты JSON‑LD рендерятся с nonce — так их не блокирует CSP. Никакого JS внутри JSON‑LD быть не должно.

---

## 3) Site‑wide блоки (задаются один раз)

### 3.1 Organization (бренд)

**Где менять:** Админка → Настройки сайта → JSON‑LD: Organization.

**Что важно заполнить:**

* `name` — бренд (например, *Swapers*).
* `url` — главная страница (например, `https://example.com`).
* `logo` — абсолютная ссылка на логотип (SVG/PNG; желательно квадратный вариант 112×112+).
* `sameAs` — список официальных страниц бренда (Telegram, VK, YouTube, Instagram, Дзен, RuTube и т.д.). Только реальные, активные ссылки.
* `contactPoint` — точки контакта (поддержка, партнёрство). Пример:

  ```json
  {
    "@type": "ContactPoint",
    "contactType": "customer support",
    "email": "support@example.com",
    "availableLanguage": ["ru", "en"]
  }
  ```

**Частые ошибки:**

* Пустой `logo` или относительный путь, отсутствие `https`.
* Неактуальные ссылки в `sameAs`.

### 3.2 WebSite (сайт)

**Где менять:** Админка → Настройки сайта → JSON‑LD: WebSite.

**Что важно:**

* `name` — то же имя бренда или сайта.
* `url` — абсолютный URL главной.
* `inLanguage` — `ru` или `en` для конкретной языковой версии.
* (Опционально) **Sitelinks Search Box** через `potentialAction`:

  ```json
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Swapers",
    "url": "https://example.com",
    "inLanguage": "ru",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://example.com/search?q={query}",
      "query-input": "required name=query"
    }
  }
  ```

---

## 4) Блоки для конкретных страниц

> Эти блоки задаём на уровне страницы/шаблона. Если модели ещё нет — можно формировать из вьюхи через `page_meta`.

### 4.1 FAQPage (страница «Вопросы и ответы»)

* Используется для выдачи расширенных FAQ‑сниппетов.
* Все вопросы/ответы **должны** быть видны на странице.
* Пример:

  ```json
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Как проходит обмен?",
        "acceptedAnswer": {"@type": "Answer", "text": "Опишите кратко процесс…"}
      },
      {
        "@type": "Question",
        "name": "Какие комиссии?",
        "acceptedAnswer": {"@type": "Answer", "text": "Укажите комиссии/условия…"}
      }
    ]
  }
  ```

### 4.2 Article / BlogPosting (новости, блог)

* Для статей с заголовком, датами, автором, картинкой.
* Минимум: `headline`, `datePublished`, `dateModified`, `author`, `image`, `inLanguage`, `mainEntityOfPage`.

### 4.3 FinancialService / Organization (подстраницы сервиса)

* Для страниц, описывающих услугу обмена криптовалют.
* Подходящий тип: `FinancialService` (или `Service`, если описание общее). Пример каркаса:

  ```json
  {
    "@context": "https://schema.org",
    "@type": "FinancialService",
    "name": "Swapers — обмен криптовалют",
    "url": "https://example.com/ru/exchange/",
    "inLanguage": "ru",
    "serviceType": "Cryptocurrency exchange",
    "areaServed": "Worldwide",
    "currenciesAccepted": ["BTC", "ETH", "USDT", "USDC"],
    "termsOfService": "https://example.com/ru/terms/",
    "provider": {
      "@type": "Organization",
      "name": "Swapers",
      "url": "https://example.com"
    }
  }
  ```
* **Не** добавляем `AggregateRating`/`Offer`/`PriceSpecification`, если таких данных реально нет на странице.

### 4.4 BreadcrumbList (хлебные крошки)

* Полезно для вложенных страниц (например, /faq/, /blog/post/…).
* Должно соответствовать реальной навигации на странице.

---

## 5) Мультиязычность и дубли страниц

* Для RU‑страницы используем `inLanguage: "ru"` и `url` на RU‑версию.
* Для EN‑страницы — `inLanguage: "en"` и URL на EN.
* Не смешиваем языки в одном блоке.
* Hreflang ссылается между RU/EN версиями на уровне `<head>`, а JSON‑LD — про каждую страницу **отдельно**.

---

## 6) Картинки и файлы

* **Логотип и изображения** должны открываться по абсолютному `https`‑URL (в медиахранилище сайта).
* Минимальные требования: логотип бренда — квадрат 112×112+; OG/Twitter карты — \~1200×630 (допуск по пропорциям \~1.91:1).

---

## 7) Проверка и отладка

1. Открой страницу → **View Source** → найди `<script type="application/ld+json">`.
2. Прогон через валидаторы: *Rich Results Test* и *Schema Markup Validator*. Исправляй предупреждения.
3. Следи за логами CSP: JSON‑LD не должен блокироваться политикой скриптов (у нас скрипты отдаются с nonce).

---

## 8) Частые ошибки и как их избежать

* **Относительные ссылки** → всегда указывай абсолютные `https://…`.
* **Дублирующиеся/противоречивые блоки** → на одной странице у каждого типа должна быть одна «осмысленная» версия.
* **Данные не соответствуют странице** → всё, что в JSON‑LD, должно быть на странице в явном виде.
* **Нереальные рейтинги/отзывы** → не добавлять, пока не настроен сбор и показ на странице.

---

## 9) Мини‑чеклисты

**Главная (RU/EN):**

* Organization: name, url, logo, sameAs, contactPoint.
* WebSite: name, url, inLanguage, (опц.) SearchAction.
* (опц.) FinancialService — если на главной подробно описана услуга.

**FAQ:**

* FAQPage с перечислением вопросов/ответов (совпадает с видимым контентом).

**Блог/новости:**

* Article/BlogPosting: headline, dates, author, image, inLanguage, mainEntityOfPage.

**Страница услуги/процесс обмена:**

* FinancialService/Service: name, url, inLanguage, serviceType, areaServed, termsOfService, provider.

---

## 10) Как это связано с админкой Swapers

* Базовые блоки Organization и WebSite задаются в `Настройки сайта` и уже попадают на все страницы по умолчанию.
* Для специальных страниц (FAQ, статьи, обмен) добавляем JSON‑LD на уровне страницы/шаблона (через `page_meta`).
* При правках настроек сайт‑вайд полей не забываем проверить фронт (истёкшие логотипы, битые ссылки).

---

### Вопросы и обновления

Если потребуется новый тип разметки (например, HowTo/HowToStep для гайдов), заводим задачу и валидируем пример через официальные инструменты, прежде чем включать в прод.
