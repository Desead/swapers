# Настройки сайта (SiteSetup)

`SiteSetup` — синглтон-модель (одна запись), хранит глобальные параметры сайта. Сейчас используются два поля:

- `admin_path` — кастомный префикс для админки (пример: `superadmin`)
- `otp_issuer` — имя сервиса для 2FA (показывается в приложении-аутентификаторе)

Открыть в админке: **Настройки сайта**.
Список в админке сразу ведёт к форме единственной записи.

## Важные нюансы
- **Перезагрузка сервера**: изменения `admin_path` и `otp_issuer` требуют **рестарта** приложения/процесса, чтобы все воркеры видели новое значение.
  (Текущий процесс обновляется сигналом, но в продакшене — делайте рестарт.)
- **Редирект со стандартного `/admin/`** включён: если путь кастомный, переход со старого `/admin/` вернёт 301 на актуальный префикс.
- **Резервированные префиксы** для `admin_path` (например, `static`, `media`) запрещены.

## Как используется
- Маршрутизация админки монтируется на префикс из `SiteSetup` при загрузке `urls.py`.
- Путь админки отображается в шапке сайта (для staff): «Админка: /…/».
- Issuer для 2FA берётся из `SiteSetup.otp_issuer` при генерации QR.

## Кэш и производительность
- Доступ к `SiteSetup` идёт через сервис `app_main/services/site_setup.py` с кешированием (`get_site_setup()`, `get_admin_prefix()`).
- При сохранении `SiteSetup` кэш инвалидируется сигналом.

## Что делать при “потерях”
- Если случайно поставили пустой/некорректный `admin_path`, форма не сохранится (валидация).
- Если забыли новый путь — смотрите его в шапке сайта (для staff) или через админку/БД.
- После смены пути/issuer — **перезапуск** приложения обязателен.

## Куда добавлять новые глобальные настройки
Расширять модель `SiteSetup` (логотип, домен, SEO, контакты, комиссии и т.п.).
Поля, изменения которых должны применяться только после перезапуска, держите в отдельном fieldset’е «Требует перезагрузки сервера» (см. админ-форму `SiteSetupAdmin`).
